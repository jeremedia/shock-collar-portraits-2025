<div class="p-6">
  <!-- Header -->
  <div class="border-b border-gray-700 pb-4 mb-6">
    <div class="flex justify-between items-start">
      <div>
        <h2 class="text-2xl font-bold text-yellow-500"><%= visitor.email %></h2>
        <% if visitor.name.present? %>
          <p class="text-gray-400"><%= visitor.name %></p>
        <% end %>
      </div>
      <button onclick="document.getElementById('visitor-modal').classList.add('hidden')"
              class="text-gray-400 hover:text-white text-2xl">√ó</button>
    </div>
  </div>

  <!-- Key Stats -->
  <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <div class="bg-gray-800 rounded p-4">
      <div class="text-2xl font-bold text-purple-400"><%= stats[:total_visits] %></div>
      <div class="text-sm text-gray-400">Total Visits</div>
    </div>
    <div class="bg-gray-800 rounded p-4">
      <div class="text-2xl font-bold text-green-400"><%= stats[:total_photos_viewed] %></div>
      <div class="text-sm text-gray-400">Photos Viewed</div>
    </div>
    <div class="bg-gray-800 rounded p-4">
      <div class="text-2xl font-bold text-orange-400">
        <%= distance_of_time_in_words(stats[:total_time_spent]) %>
      </div>
      <div class="text-sm text-gray-400">Total Time</div>
    </div>
    <div class="bg-gray-800 rounded p-4">
      <div class="text-2xl font-bold text-cyan-400">
        <%= distance_of_time_in_words(stats[:average_session_duration]) %>
      </div>
      <div class="text-sm text-gray-400">Avg Session</div>
    </div>
  </div>

  <!-- Timeline -->
  <div class="mb-6">
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-lg font-bold text-yellow-400">üìÖ Timeline</h3>
      <div class="text-sm text-gray-400">
        First visit: <%= stats[:first_visit]&.strftime("%b %d, %Y") %>
        <% if stats[:last_visit] != stats[:first_visit] %>
          ‚Ä¢ Last visit: <%= stats[:last_visit]&.strftime("%b %d, %Y") %>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Favorite Session -->
  <% if stats[:favorite_session] %>
    <div class="bg-purple-900/20 border border-purple-600 rounded p-4 mb-6">
      <h3 class="text-lg font-bold text-purple-400 mb-2">‚≠ê Favorite Session</h3>
      <div class="text-sm">
        <p>Session #<%= stats[:favorite_session].session_number %></p>
        <p class="text-gray-400">
          <%= stats[:favorite_session].name || "Untitled" %>
          ‚Ä¢ <%= stats[:favorite_session].photos.count %> photos
        </p>
      </div>
    </div>
  <% end %>

  <!-- Device & Location Info -->
  <div class="grid lg:grid-cols-2 gap-4 mb-6">
    <div class="bg-gray-800 rounded p-4">
      <h4 class="font-bold text-teal-400 mb-2">üì± Devices Used</h4>
      <div class="text-sm space-y-1">
        <% stats[:devices_used].each do |device| %>
          <div class="text-gray-300"><%= device || "Unknown" %></div>
        <% end %>
      </div>
    </div>
    <div class="bg-gray-800 rounded p-4">
      <h4 class="font-bold text-pink-400 mb-2">üåç Locations</h4>
      <div class="text-sm space-y-1">
        <% stats[:locations].each do |location| %>
          <div class="text-gray-300"><%= location %></div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Visit History -->
  <div class="mb-6">
    <h3 class="text-lg font-bold text-yellow-400 mb-3">üìä Visit History</h3>
    <div class="space-y-3 max-h-96 overflow-y-auto">
      <% @visits.each do |visit| %>
        <div class="bg-gray-800 rounded p-4">
          <div class="flex justify-between items-start mb-2">
            <div>
              <div class="font-semibold text-white">
                <%= visit.started_at.strftime("%B %d, %Y at %l:%M %p") %>
              </div>
              <div class="text-sm text-gray-400">
                <%= visit.browser %> on <%= visit.os %>
                <% if visit.device_type.present? %>
                  ‚Ä¢ <%= visit.device_type %>
                <% end %>
              </div>
            </div>
            <div class="text-right">
              <div class="text-xl font-bold text-yellow-500"><%= visit.events.count %></div>
              <div class="text-xs text-gray-400">actions</div>
            </div>
          </div>

          <!-- Session Events -->
          <% if visit.events.any? %>
            <div class="mt-3 pt-3 border-t border-gray-700">
              <div class="text-xs text-gray-400 mb-2">Activity Summary:</div>
              <div class="text-sm space-y-1">
                <% photo_events = visit.events.where(name: ["Viewed photo", "Photo view", "$view"]) %>
                <% if photo_events.any? %>
                  <div class="text-green-400">
                    üëÅÔ∏è Viewed <%= photo_events.count %> photo<%= 's' if photo_events.count != 1 %>
                  </div>
                <% end %>

                <% duration = visit.events.maximum(:time) - visit.started_at %>
                <% if duration > 0 %>
                  <div class="text-cyan-400">
                    ‚è±Ô∏è Session duration: <%= distance_of_time_in_words(duration) %>
                  </div>
                <% end %>

                <% if visit.landing_page.present? %>
                  <div class="text-purple-400">
                    üìç Landing: <%= URI.parse(visit.landing_page).path rescue visit.landing_page %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Viewed Photos Grid -->
  <% if @viewed_photos.any? %>
    <div>
      <h3 class="text-lg font-bold text-yellow-400 mb-3">üì∏ Photos Viewed (<%= @viewed_photos.count %>)</h3>
      <div class="grid grid-cols-4 lg:grid-cols-6 gap-2">
        <% @viewed_photos.first(24).each do |photo| %>
          <div class="bg-gray-800 rounded p-2 text-center">
            <div class="text-xs font-bold text-yellow-500">
              S<%= photo.photo_session&.session_number || "?" %>
            </div>
            <div class="text-xs text-gray-400">
              #<%= photo.position %>
            </div>
          </div>
        <% end %>
        <% if @viewed_photos.count > 24 %>
          <div class="bg-gray-800 rounded p-2 text-center flex items-center justify-center">
            <div class="text-xs text-gray-400">
              +<%= @viewed_photos.count - 24 %> more
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>