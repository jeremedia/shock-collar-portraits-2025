<%
  # Get hero photo directly from PhotoSession (not from unreliable Sitting model)
  hero_photo = session.hero_photo
  has_hero_selection = session.hero_photo_id.present?

  # Use pre-loaded middle photo if no hero selected
  display_photo = hero_photo || @middle_photos[session.id]

  # Use pre-loaded face count from controller
  has_faces = @face_counts && @face_counts[session.id].to_i > 0

  # Only look for face photo if we have faces
  face_photo = has_faces ? display_photo : nil

  # Use actual session ID
  session_id = session.id
%>

<%= link_to session_path(session.id),
            class: "session-card block bg-black border-2 border-red-700 rounded-lg overflow-hidden hover:border-yellow-500 transition-all duration-300 transform hover:scale-105 hero-variant-face",
            data: {
              session_id: session.id,
              burst_id: session.burst_id,
              has_faces: has_faces,
              thumbnail_card: true
            } do %>
  
  <div class="thumbnail-container relative bg-gradient-to-b from-red-900/20 to-black overflow-hidden"
       data-controller="lazy-images"
       data-thumbnail-container="true">

    <!-- Hero selection indicator removed -->

    <% sources = hero_thumbnail_sources(display_photo) %>
    <% display_url = sources[:default] %>
    <% thumb_url = sources[:thumb] %>
    <% face_url = sources[:face] %>
    <% portrait_url = sources[:portrait] %>

    <img data-lazy-images-target="image"
         data-src="<%= display_url || 'data:image/gif;base64,R0lGODlhAQABAAAAACw=' %>"
         src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='400'%3E%3Crect width='100%25' height='100%25' fill='%23374151'/%3E%3C/svg%3E"
         data-hero-thumb-src="<%= thumb_url %>"
         data-hero-face-src="<%= face_url %>"
         data-hero-portrait-src="<%= portrait_url %>"
         data-hero-current-src="<%= display_url %>"
         data-hero-variant="face"
         alt="Sitting <%= session_id %>"
         class="w-full h-full object-cover session-thumbnail" />

    <%= render "shared/thumbnail_loader" %>
  </div>
  
  <div class="session-info hidden md:block p-4 bg-gradient-to-b from-red-900/10 to-black/50">
    <h4 class="text-lg font-bold text-yellow-500 uppercase mb-1">
      Sitting <%= session_id %> - <%= session.started_at.in_time_zone('America/Los_Angeles').strftime("%-l:%M %p") %>
    </h4>
    <p class="text-white text-sm">
      <%= session.photo_count %> photos
    </p>

    <!-- Hidden additional info for potential future use -->
    <div class="hidden">
      <% if session.ended_at && session.started_at %>
        <span class="text-gray-400">â€¢ <%= ((session.ended_at - session.started_at) / 60).round %>m</span>
      <% end %>

      <% if current_user&.admin? %>
        <div class="mt-2 flex gap-1">
          <% if session.sittings.any? %>
            <span class="text-xs bg-green-800 px-1 rounded">âœ“ sitting</span>
          <% end %>
          <% if has_faces %>
            <span class="text-xs bg-blue-800 px-1 rounded">ðŸ‘¤ faces</span>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
